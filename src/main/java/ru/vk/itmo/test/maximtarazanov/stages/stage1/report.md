# Таразанов Максим, ИТМО, М4139, Stage 1

Работа выполнена на WSL2.

При выполнении задания использовалась референсный **dao**.
В первую очередь было решено проверить точку разладки при сведении задержки запросов в **wrk2** к минимуму, а именно звонить по константному адресу в одну память. Для этого использовались скрипты *get.lua* и *put.lua*. Для них получилось около 7500rps и 7000rps соответственно.
Далее были реализованы *getmany.lua* и *putmany.lua*, тестирование проводилось на 7000rps.
## GET-запросы
- Alloc
![[getmany_filled_7000_alloc.png]]
Около 60% выделяется на handleRequest, из которых 20% на создание реквеста, 40% на сервер. Стоит заметить, что больша'я часть памяти в совокупности нужна для создания memorySegment'ов.
Также около 20% аллокаций происходит на парсинг реквеста.

- CPU
![[getmany_filled_7000_cpu.png]]
Больше половины времени уходит на запись в сокет.

## PUT-запросы
- Alloc
![[putmany_empty_7000_alloc.png]]
Около 60% также уходит на handleRequest, но на этот раз на сервер уходит ме'ньшая часть (порядка 35%). В совокупности опять же бо'льшая часть памяти уходит также на создание memorySegment'ов.

- CPU
![[putmany_empty_7000_cpu.png]]
Больше половины времени уходит на запись в сокет.

## Улучшения
Предлагается сделать меньше операций со String путём работы с байтами запроса.